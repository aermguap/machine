#define _CRT_SECURE_NO_WARNINGS
#include <stdio.h>
#include <stdlib.h>


void saveo(double T1, double T2, double z, int i) {
	printf("%f | %f | %f         - %d\n", T1, T2, z, i);
	printf("_________________________________________\n");
}
void endo(double* a, double* xq, double* xw, double* y) {
	int count = 0;
	for (int i = 0; i < 345; i++) {
		if (a[i] == 0.000000)  //lose data
			i++;
		else
			printf("%f | %f | %f         - %d\n", a[i], a[i + 345], a[i + 690], i);
	}
	printf("_________________________________________\n");
	printf("_________________________________________\n");
	double end = 0; 	double endT1 = 0; 	double endT2 = 0;
	for (int i = 0; i < 345; i++) {
		if (a[i] == 0.000000)
			i++;
		else {
			count++;
			end = end + a[i];
		}
	}
	end = end / count;
	endT1 = end;
	printf("endT1 -  %f", endT1);
	count = 0;
	end = 0;
	for (int i = 345; i < 690; i++) {
		if (a[i] == 0.000000)
			i++;
		else {
			count++;
			end = end + a[i];
		}
	}
	end = end / count;
	endT2 = end;
	printf("     |      endT2 -  %f", endT2);
	// _______________________________________________________________________________________
	printf("\n");
	double c; double b;

	printf("\n\n%f - result/ train 60", (xq[60] * endT1 + xw[60] * endT2));      //должно быть 22.9 
	double lose_lv = 0;
	for (int i = 0; i < 345; i++) {
		lose_lv = lose_lv + (xq[i] * endT1 + xw[i] * endT2 - y[i]);
	}
	lose_lv = lose_lv / 345;
	printf("\n\n%f - middle lose", lose_lv);
}

double loss(double* xq, double* xw, double* y, double T1, double T2, int i)
{
	double loss = 0;

	loss = ((xq[i] * T1 + xw[i] * T2) - y[i]);
	return loss;
}
double gard(double* xq, double* xw, double* y, double T1, double T2) {
	double los;
	double p;
	double z;
	double buf;
	double a[1035] = { 0 };
	float speed_level = 100;    // 1- 1000
	for (int i = 0; i < 345; i++) {
		double h = (loss(xq, xw, y, T1, T2, i));
		if ((loss(xq, xw, y, T1, T2, i) < 0))
			while (loss(xq, xw, y, T1, T2, i) < -1) {
				h = (loss(xq, xw, y, T1, T2, i));
				buf = T1;
				T1 = T1 + (loss(xq, xw, y, T1, T2, i) / (400 * speed_level));
				if (loss(xq, xw, y, buf, T2, i) > loss(xq, xw, y, T1, T2, i))
					T1 = T1 - (loss(xq, xw, y, T1, T2, i) / (200 * speed_level));
				a[i] = T1;
				buf = T2;
				T2 = T2 + (loss(xq, xw, y, T1, T2, i) / (400 * speed_level));
				if (loss(xq, xw, y, T1, buf, i) > loss(xq, xw, y, T1, T2, i))
					T2 = T2 - (loss(xq, xw, y, T1, T2, i) / (200 * speed_level));
				a[345 + i] = T2;
				a[690 + i] = (loss(xq, xw, y, T1, T2, i));
				if (loss(xq, xw, y, T1, T2, i) < h) {
					printf("sorry Kianu...");
					return 0;
				}
			}
		if ((loss(xq, xw, y, T1, T2, i) > 0))
			while (loss(xq, xw, y, T1, T2, i) > 1) {
				h = (loss(xq, xw, y, T1, T2, i));
				buf = T1;
				T1 = T1 + (loss(xq, xw, y, T1, T2, i) / 400);
				if (loss(xq, xw, y, buf, T2, i) < loss(xq, xw, y, T1, T2, i))
					T1 = T1 - (loss(xq, xw, y, T1, T2, i) / 200);
				a[i] = T1;
				buf = T2;
				T2 = T2 + (loss(xq, xw, y, T1, T2, i) / 400);
				if (loss(xq, xw, y, T1, buf, i) < loss(xq, xw, y, T1, T2, i))
					T2 = T2 - (loss(xq, xw, y, T1, T2, i) / 200);
				a[345 + i] = T2;
				a[690 + i] = (loss(xq, xw, y, T1, T2, i));
				if (loss(xq, xw, y, T1, T2, i) > h) {
					printf("sorry Kianu...");
					return 0;
				}
			}
		z = loss(xq, xw, y, T1, T2, i);
	}
	endo(a, xq, xw, y);
}

int main()
{

	printf("wake up, samurai\n\n");
	printf("T1        |    T2    |   LOSS\n");
	int T1 = -3;
	int T2 = 2;
	double x[] = {
	23.98,6.459,21.52,6.193,7.74,6.75,4.81,7.249,18.06,5.454,5.9,6.487,2.94,6.998,6.36,7.163,17.44,6.749,4.56,6.975,30.81,5.399,4.59,6.968,5.81,6.169,15.76,5.928,14.81,5.813,23.27,6.629,5.5,7.007,7.12,3.561,11.22,6.358,14.65,6.376,18.34,5.637,15.71,5.889,22.74,6.824,12.12,5.012,9.1,5.874,2.98,6.854,11.97,6.279,21.32,6.003,5.7,7.079,3.01,7.645,9.64,5.859,8.58,6.127,14.0,4.963,16.3,5.924,1.73,7.489,7.79,6.398,4.82,7.155,7.9,6.266,13.61,5.731,10.53,6.014,12.43,6.012,20.45,6.377,9.93,6.879,21.78,6.223,11.1,6.319,7.22,6.619,12.4,6.095,8.65,6.54,4.16,6.826,18.03,6.185,8.93,6.616,6.36,6.481,24.56,5.52,4.73,7.358,8.23,6.453,19.37,6.405,4.85,6.812,18.71,6.728,7.51,6.167,8.16,6.442,10.21,5.682,15.94,5.782,14.15,5.786,13.15,6.153,10.15,6.226,4.74,7.041,13.65,5.92,8.47,5.834,23.34,4.138,22.98,5.683,6.86,6.145,13.34,5.871,5.98,6.49,9.22,5.927,18.13,6.185,4.32,6.595,7.26,7.52,16.29,6.167,16.51,5.599,7.6,6.315,16.22,6.436,9.62,6.389,14.44,5.966,9.43,6.115,15.69,5.837,12.93,6.23,22.88,5.627,13.27,6.009,11.38,6.897,7.7,6.041,14.67,5.99,23.69,6.38,8.1,5.878,3.76,7.82,17.58,5.879,23.09,5.344,13.35,5.983,11.34,6.163,13.09,5.594,8.01,6.037,9.38,6.375,18.66,5.836,5.33,7.147,14.1,5.648,10.63,6.405,10.58,6.312,3.54,8.259,3.59,6.438,6.21,6.211,7.39,6.51,7.53,6.849,9.14,6.421,8.77,5.85,7.88,6.03,3.7,7.929,18.33,5.914,4.03,7.185,6.65,6.625,19.88,5.813,6.9,6.842,9.09,6.144,23.98,5.404,15.03,5.822,18.05,6.461,7.19,6.482,26.82,5.403,19.52,6.406,9.5,6.59,3.76,6.552,4.61,6.874,9.16,6.108,14.52,6.202,6.53,6.63,6.56,6.718,15.12,6.129,9.45,6.144,6.78,6.273,6.48,6.794,9.67,6.593,15.39,6.431,16.23,6.301,21.02,5.57,12.67,6.112,7.2,6.426,23.6,5.536,3.56,7.148,4.21,8.069,14.76,5.713,24.91,5.304,3.33,6.861,3.53,6.957,8.79,5.885,8.44,6.121,10.45,6.254,13.27,6.395,12.03,6.425,13.44,7.313,4.08,7.287,12.14,5.877,12.33,6.167,15.02,6.411,12.92,6.019,10.27,6.14,2.87,7.178,14.8,5.888,11.28,5.727,24.1,6.162,6.92,6.86,5.12,8.704,9.25,5.876,9.47,6.182,29.05,6.434,5.03,6.8,12.6,6.458,14.7,6.081,9.42,6.727,12.03,5.88,34.02,5.935,23.24,6.649,16.94,5.936,26.42,5.468,8.05,5.663,9.8,5.869,3.11,7.61,4.45,7.135,11.5,5.705,28.32,5.186,3.16,7.47,14.27,6.004,16.9,5.942,14.1,5.794,16.44,6.251,3.95,6.816,4.38,6.604,13.0,5.856,17.11,5.713,9.5,6.762,6.72,6.417,14.64,5.803,6.59,6.24,24.08,6.38,14.79,7.014,9.53,6.216,17.64,6.348,11.32,6.402,11.41,5.841,5.19,6.393,6.72,6.302,9.59,7.203,5.99,6.635,16.42,6.701,18.72,6.142,10.56,5.895,4.54,6.635,11.66,6.98,7.37,6.606,9.71,6.951,8.26,5.949,17.15,5.952,5.5,6.25,5.52,6.065,6.29,6.315,6.05,7.267,13.33,3.863,9.68,5.933,6.15,6.312,18.06,5.783,4.63,8.725,14.37,5.87,13.51,5.888,11.98,6.674,6.36,6.516,4.56,6.556,14.13,5.759,5.08,6.431,7.56,7.765,3.95,8.247,27.38,5.531,20.32,6.343,9.81,6.101,27.26,5.613,7.01,7.061,8.1,7.206,8.05,7.104,17.16,5.565,29.55,5.412,18.85,6.485,30.63,4.368,8.51,6.059,23.29,6.103,5.33,6.546,30.59,5.453,25.79,6.782,14.69,5.572,7.83,6.031,27.71,5.95,13.04,6.072,2.47,8.337,10.88,6.086,37.97,4.138,19.92,5.747,26.4,5.617,6.68,6.782,9.04,6.416,20.85,5.39,10.29,6.513,4.86,6.982,10.13,5.966,10.45,5.56,17.27,6.297,10.26,6.096,10.59,6.249,6.58,5.935,18.76,6.051,5.49,7.241,9.69,6.642,9.51,6.565,20.08,5.155,12.01,5.707,12.34,6.232,8.2,6.405,31.99,5.0,5.68,6.563,17.21,6.968,11.74,5.708,7.44,8.297,5.1,6.951,18.07,5.983,15.55,6.229,5.29,8.78,17.6,6.212,16.96,6.335,18.46,5.605,3.73,6.683,3.53,6.758,29.53,4.926,16.47,5.851,10.4,6.009,6.12,6.415,7.79,7.333,7.14,6.209,10.42,5.762,5.04,6.98,14.19,6.251,11.64,5.854,13.0,6.195,30.62,4.88,3.11,7.454,9.28,6.567,5.21,6.43,13.99,6.317,29.29,4.903,13.44,6.137,17.27,5.96,30.81,5.277,13.59,5.926,4.84,6.77,10.19,5.362,14.59,6.454,21.24,6.794,6.57,6.108,16.65,5.628,14.81,5.986,12.86,6.015,18.13,5.926,22.6,5.713,19.69,6.833,4.67,6.29,3.81,7.853,10.87,5.891,9.55,6.069,17.28,6.047,5.29,6.727,26.45,6.152,17.09,6.092,29.97,5.852,2.88,8.034,19.15,6.172,14.66,6.064,6.43,6.066,16.21,5.913,21.22,6.657,17.79,6.341,5.25,7.412,3.92,7.686,29.93,5.631,7.54,6.245,26.77,5.987,15.37,5.872,14.98,6.114,5.39,7.185,17.6,5.67,10.97,6.326,5.57,5.936 };
	double y[] = {
	11.8,11.0,23.7,35.4,15.2,24.4,33.4,31.6,13.4,34.9,14.4,35.4,25.3,18.3,16.6,13.4,23.6,27.5,22.2,17.7,14.3,21.7,8.4,15.3,20.3,32.0,20.0,19.1,28.7,46.0,22.6,23.9,21.9,15.6,50.0,25.0,37.9,21.6,19.3,17.5,22.9,15.0,27.5,10.2,23.8,23.9,20.1,16.5,33.1,14.6,28.4,23.7,12.3,31.5,22.0,12.5,35.1,14.9,22.9,22.9,19.3,19.8,20.0,29.6,20.5,29.0,20.7,19.9,11.9,5.0,23.3,20.6,22.9,19.6,14.1,30.8,43.1,19.9,13.9,22.3,14.3,23.9,16.0,20.5,10.2,20.1,12.8,18.9,22.0,20.4,17.5,13.1,22.0,45.4,18.8,20.0,20.1,21.4,17.4,21.1,28.1,19.5,36.2,20.8,18.6,21.2,42.8,24.8,25.0,23.3,28.2,21.6,21.0,11.9,50.0,17.8,34.7,28.4,14.5,30.1,19.8,19.3,18.4,9.6,29.1,13.4,17.1,22.0,31.5,31.2,24.3,10.9,26.6,26.2,17.0,36.2,24.1,22.0,22.4,18.0,14.9,13.6,22.6,23.8,11.3,37.3,38.7,20.1,12.0,28.5,29.6,20.9,22.2,18.5,21.7,16.1,15.0,33.3,23.8,20.1,16.7,21.2,20.8,36.4,18.9,18.2,13.3,29.9,50.0,20.9,25.0,7.2,31.1,19.2,20.0,27.5,19.1,8.4,13.9,13.5,15.6,18.2,19.5,42.3,32.9,16.2,17.8,43.5,20.3,17.4,18.3,12.6,31.6,29.1,21.1,15.1,25.0,24.2,16.8,25.2,9.5,30.7,50.0,14.5,22.3,20.0,23.7,24.8,33.8,24.5,16.4,15.2,18.5,22.8,29.8,23.3,26.7,20.4,19.0,27.0,22.8,24.6,33.2,23.1,18.9,23.0,22.5,50.0,22.0,23.3,21.0,23.1,29.8,19.9,24.6,39.8,48.3,8.5,7.2,25.0,15.7,25.0,36.5,33.0,11.7,23.7,15.4,8.8,20.6,13.4,29.4,5.0,7.5,23.1,19.4,13.2,14.5,41.7,24.0,13.8,8.5,17.2,32.0,23.6,11.5,20.2,33.1,24.7,22.8,16.1,18.2,20.6,23.1,23.2,32.7,28.7,24.8,16.3,21.8,21.2,22.0,7.4,32.5,10.4,18.5,50.0,37.0,13.6,19.4,21.9,17.8,18.1,18.5,50.0,32.4,14.6,19.5,21.7,25.0,36.0,23.2,21.8,37.2,19.9,22.7,21.7,10.2,44.0,23.8,28.7,19.5,11.8,19.3,21.7,7.2,24.5,26.6,20.8,17.1,13.3,21.9,15.6,21.4,22.5,19.1,12.7,14.1,23.5,48.5,22.6,21.2,14.8,28.0,8.7,18.7,6.3,50.0,27.1,24.4,24.3,18.8,17.2,14.9,31.7,46.7,16.5,23.4,5.6,20.4,19.1,34.9,23.1,24.4,20.6 };
	double xq[355];
	double xw[355];
	for (int i = 0; i < 710; i = i + 2)
		xq[i / 2] = x[i];
	for (int i = 1; i < 710; i = i + 2)
		xw[(i - 1) / 2] = x[i];
	gard(xq, xw, y, T1, T2);

	return 0;
}